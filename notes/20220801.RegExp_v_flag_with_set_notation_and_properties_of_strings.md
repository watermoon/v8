# RegExp `v` flag with set notation and properties of strings

## JavaScript ä¸­æ­£åˆ™çš„å†å²
1. ECMAScript 3(1999) å¼€å§‹æ”¯æŒ
2. ES2015 å¼•å…¥ `Unicode æ¨¡å¼(u)ã€ä¸¥æ ¼æ¨¡å¼(y)ã€å’Œ flags å±æ€§(è¿”å›æ­£åˆ™å¯¹è±¡çš„æ¨¡å¼, å³è¿”å› uygi ç­‰)`
3. ES2018 å¼•å…¥ `dotAllæ¨¡å¼(â€˜s', ç‚¹å·åŒ¹é…æ‰€æœ‰å­—ç¬¦. æ³¨æ„ä¸åŒ¹é…è¡Œç»“æŸç¬¦å’Œ unicode çš„'*', 'u' æ¨¡å¼ä¸‹åˆ™å¯ä»¥åŒ¹é… unicode çš„'*'), lookbehind assert(ä»¥ä»€ä¹ˆå¼€å¤´ã€ç»“å°¾çš„åŒ¹é…, ä¸åŒ¹é…å¼€å¤´ç»“å°¾é¡¹), å…·åæ•è·ç»„, Unicode å­—ç¬¦å±æ€§è½¬ç§»(ä¾‹å¦‚ /\p{Script_Extensions=Greek}/u å¯ä»¥åŒ¹é… Greek è„šæœ¬ä¸­çš„æ‰€æœ‰å­—ç¬¦)`
4. ES2020 å¼•å…¥ matchAll æ–¹æ³•, æ˜¯çš„æ­£åˆ™æ›´æ˜“ç”¨
5. æœ€æ–°çš„åˆ™æ˜¯æœ¬æ–‡ä»‹ç»çš„å‡ ä¸ªæ–°ç‰¹æ€§

## æœ¬æ–‡ä»‹ç»çš„æ–°ç‰¹æ€§
* Unicode properties of strings
* set notation + string literal syntax
* improved case-insensitive matching

### ä½¿ç”¨æ–¹æ³•
```js
const re = /.../v;
```
`v` æ ‡è®°åŒ…å« `u` æ ‡è®°çš„æ‰€æœ‰å¥½çš„éƒ¨åˆ†, è€Œä¸”è¿˜æœ‰é¢å¤–çš„ç‰¹æ€§å’Œæå‡(æœ‰äº›å’Œ `u` æ ‡è®°ä¸å…¼å®¹, æ‰€ä»¥ä¸èƒ½ä¸¤ä¸ªæ ‡è®°åŒæ—¶ä½¿ç”¨)

## å­—ç¬¦ä¸²çš„ Unicode å±æ€§
Unicode æ ‡å‡†ç»™æ¯ä¸€ä¸ªå­—ç¬¦èµ‹äºˆäº†å±æ€§å’Œå±æ€§å€¼. ä¾‹å¦‚æƒ³è·å– Greek è„šæœ¬ä¸­ä½¿ç”¨çš„æ‰€æœ‰å­—ç¬¦, åªéœ€è¦æœç´¢ Unicode æ•°æ®åº“, è¿‡æ»¤å…¶ä¸­
`Script_Extensions` å±æ€§çš„å€¼åŒ…å« `Greek` çš„å­—ç¬¦å³å¯
* ä¹‹å‰, æ­£åˆ™å¯ä»¥åŒ¹é…å•ä¸ªå­—ç¬¦çš„ emoji è¡¨æƒ…, ä½†æ˜¯å¯¹äºå¤šå­—ç¬¦/code point çš„æ— æ³•æ”¯æŒ
```javascript
// Unicode defines a character property named â€œEmojiâ€.
const re = /^\p{Emoji}$/u;

// Match an emoji that consists of just 1 code point:
re.test('âš½'); // '\u26BD'
// â†’ true âœ…

// Match an emoji that consists of multiple code points:
re.test('ğŸ‘¨ğŸ¾â€âš•ï¸'); // '\u{1F468}\u{1F3FE}\u200D\u2695\uFE0F'
// â†’ false âŒ
```
* ç°åœ¨, å¯¹äºå¤šå­—ç¬¦çš„å±æ€§ä¹Ÿå¯ä»¥æ”¯æŒ
```javascript
const re = /^\p{RGI_Emoji}$/v;

// Match an emoji that consists of just 1 code point:
re.test('âš½'); // '\u26BD'
// â†’ true âœ…

// Match an emoji that consists of multiple code points:
re.test('ğŸ‘¨ğŸ¾â€âš•ï¸'); // '\u{1F468}\u{1F3FE}\u200D\u2695\uFE0F'
// â†’ true âœ…
```
ç›®å‰ `v` æ ‡è®°æ”¯æŒçš„ Unicode å±æ€§æœ‰:
* Basic_Emoji
* Emoji_Keycap_Sequence
* RGI_Emoji_Modifier_Sequence
* RGI_Emoji_Flag_Sequence
* RGI_Emoji_Tag_Sequence
* RGI_Emoji_ZWJ_Sequence
* RGI_Emoji

## é›†åˆè¡¨ç¤º + å­—ç¬¦ä¸²å­—é¢è¯­æ³•
`\p{}` è½¬ç§»å¯ä»¥ç”¨äºåŒ¹é…é›†åˆçš„å­—ç¬¦(ä¾‹å¦‚ Greek è„šæœ¬çš„æ‰€æœ‰å­—ç¬¦), æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå¯¹åŒ¹é…é›†åˆè¿›è¡Œä¸€äº›é›†åˆæ“ä½œ(ä¾‹å¦‚å·®é›†ã€å¹¶é›†ã€äº¤é›†, å¦‚ Greek è„šæœ¬å‡º `Ï€` å¤–çš„æ‰€æœ‰å­—ç¬¦)
### å·®é›†(é›†åˆç›¸å‡) `--`
```javascript
/[\p{Script_Extensions=Greek}--Ï€]/v.test('Ï€'); // â†’ false
/[\p{Script_Extensions=Greek}--[Î±-Î³]]/v.test('Î²'); // â†’ false
/[\p{Decimal_Number}--[0-9]]/v.test('ğ‘œ¹'); // â†’ true

// Note: ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ consists of 7 code points.

/^\p{RGI_Emoji_Tag_Sequence}$/v.test('ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿'); // â†’ true
/^[\p{RGI_Emoji_Tag_Sequence}--\q{ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿}]$/v.test('ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿'); // â†’ false
```
### äº¤é›† `&&`
```javascript
const re = [\p{White_Space}&&\p{ASCII}];
re.test('\n'); // â†’ true
re.test('\u2028'); // â†’ false
```
### å¹¶é›† ``
`[\p{Letter}\p{Number}]` ä¹‹å‰æ¨¡å¼ä¹Ÿå¯ä»¥è¿›è¡Œå•ä¸ªå­—ç¬¦çš„å¹¶é›†åŒ¹é…, ä½†æ˜¯æœ‰äº† `v` æ ‡è®°åè€…ä»¥åŠŸèƒ½å˜å¾—æ›´åŠ å¼ºå¤§(å¤šå­—ç¬¦å±æ€§çš„å¹¶é›†)
```javascript
const re = /^[\p{Emoji_Keycap_Sequence}\p{ASCII}\q{ğŸ‡§ğŸ‡ª|abc}xyz0-9]$/v;

re.test('4ï¸âƒ£'); // â†’ true
re.test('_'); // â†’ true
re.test('ğŸ‡§ğŸ‡ª'); // â†’ true
re.test('abc'); // â†’ true
re.test('x'); // â†’ true
re.test('4'); // â†’ true
```

## æå‡çš„å¤§å°å†™æ— å…³åŒ¹é…
ES2015 å¼•å…¥çš„ `u` æ ‡è®°å­˜åœ¨é—®é¢˜[2]
çœ‹ä¸‹é¢çš„ä¾‹å­:
```javascript
const re1 = /\p{Lowercase_Letter}/giu;    // \p{Lowercase_Letter} åŒ¹é…æ‰€æœ‰çš„å°å†™å­—æ¯
const re2 = /[^\P{Lowercase_Letter}]/giu; // \P{Lowercase_Letter} åŒ¹é…æ‰€æœ‰çš„éå°å†™å­—æ¯
```
ç›´è§‰ä¸Š, ä½ å¯èƒ½å¸Œæœ›ä¸¤ä¸ªæ­£åˆ™çš„è¡Œä¸ºä¸€æ ·, ä½†æ˜¯å®é™…ä¸Šå´å·®åˆ«å¾ˆå¤§
```javascript
const string = 'aAbBcC4#';

string.replaceAll(re1, 'X');
// â†’ 'XXXXXX4#'

string.replaceAll(re2, 'X');
// â†’ 'aAbBcC4#''
```
æ–°çš„ `v` æ ‡è®°å, ä¸¤ä¸ªæ¨¡å¼çš„è¡Œä¸ºå˜å¾—ä¸€è‡´äº†
```javascript
const re1 = /\p{Lowercase_Letter}/giv;
const re2 = /[^\P{Lowercase_Letter}]/giv;

const string = 'aAbBcC4#';

string.replaceAll(re1, 'X');
// â†’ 'XXXXXX4#'

string.replaceAll(re2, 'X');
// â†’ 'XXXXXX4#'
```

## è¿›ä¸€æ­¥é˜…è¯»(Further reading)
ææ¡ˆ[3]åŒ…å«äº†æ›´å¤šçš„ç»†èŠ‚ä»¥åŠè¿™äº›ç‰¹æ€§çš„ç›¸å…³èƒŒæ™¯å’Œè®¾è®¡å†³ç­–

## RegExp `v` æ ‡è®°æ”¯æŒ
ç›®å‰è¿˜æ²¡æœ‰ä»»ä½• JS å¼•æ“æ”¯æŒ, åªæœ‰ Babel(ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨, ä¸»è¦ç”¨äºå°† ECMAScript 2015+ è½¬æ¢æˆæ›´è€æ ‡å‡†çš„ js ä»£ç ) 7.17.0 æ”¯æŒäº†

## å‚è€ƒèµ„æ–™
1. [åŸæ–‡é“¾æ¥](https://v8.dev/features/regexp-v-flag)
2. [IgnoreCase vs. complement vs. nested class #30](https://github.com/tc39/proposal-regexp-v-flag/issues/30)
3. [The proposal repository](https://github.com/tc39/proposal-regexp-v-flag)
